<html>
<body>

<canvas id="canvas" width="1000" height="1000"></canvas>

<script src="node_modules/lindenmayer/dist/lindenmayer.browser.js"></script>

<script>

var canvas = document.getElementById('canvas')
var ctx = canvas.getContext("2d")

// translate to center of canvas
ctx.translate(canvas.width / 2, canvas.height *0.66)

// now define the parameters for figure 1.24c

var angle = 20; //<-- change branching angle 
var iterations = 7; // <-- change number of iterations

// create some variables which describe the position and orientation of the turtle
var x = 0;
var y = 0;
var orientation = 11; //as close to vertical as I can get it

// create var state so we can call ] before [ 
// var state = {
//     x: 0,
//     y: 0,
//     orientation: 0
// };
var stack = [];
// define the tree generation L-system
var tree = new LSystem({
  axiom: 'X', // <-- change axiom
  productions: {
    'X': 'F[+X]F[-X]+X', // <-- change production rule(s)
    'F': 'FF'
  },
  finals: {
    '+': () => { orientation += (Math.PI/180) * angle//, console.log("new phi:", orientation) 
}, 
    '-': () => { orientation -= (Math.PI/180) * angle//, console.log("new phi:", orientation) 
},
    // save the current turtle position and orientation to a list
    '[': () => { stack.push( { 'x': x, 'y': y, 'orientation': orientation } ) }, 
    // set the turtle's position and orientiation to most recent values from list
    ']': () => { state = stack.pop(); x = state.x, y = state.y, orientation = state.orientation//, console.log("Popping x,y,phi: ", state)  
},  
    // pass plotting instructions to the turtle
    'F': () => {
      // create a line
      ctx.beginPath()
      // start it at x,y
      ctx.moveTo(x, y)
      //console.log(" x, y, phi:", x, y, orientation)
      // calculate the new coordinates 
      // decrease factor d:
      d = 15/(tree.iterations + 1)
      //d = 10
      // calculate 
      x += d * Math.cos(orientation)
      y += d * Math.sin(orientation)
      // draw a line to the new point 
      ctx.lineTo(x, y) 
      //console.log("New x, y", x, y)
      // plot the line with stroke()
      ctx.stroke()
      }
   }
});

tree.iterate(iterations)
tree.final()
</script>


</body>
</html>