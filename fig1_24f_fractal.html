<html>
<body>

<canvas id="canvas" width="1000" height="1000"></canvas>

<script src="node_modules/lindenmayer/dist/lindenmayer.browser.js"></script>

<script>

var canvas = document.getElementById('canvas')
var ctx = canvas.getContext("2d")

// translate to center of canvas
ctx.translate(canvas.width / 2, canvas.height *0.60)

// now define the parameters for figure 1.24c

var angle = 22.5;
var iterations = 5;
var initLine = 40;

// create some variables which describe the position and orientation of the turtle
var x = 0;
var y = 0;
var orientation = 300;
// create var stack which will collect states 
var stack = [];
// define the tree generation L-system
var tree = new LSystem({
  finals: {
    '+': () => { orientation += (Math.PI/180) * angle//, console.log("new phi:", orientation) 
  }, 
    '-': () => { orientation -= (Math.PI/180) * angle//, console.log("new phi:", orientation) 
  },
    // save the current turtle position and orientation to a list
    '[': () => { stack.push( { 'x': x, 'y': y, 'orientation': orientation } ) }, 
    // set the turtle's position and orientiation to most recent values from list
    ']': () => { state = stack.pop(); x = state.x, y = state.y, orientation = state.orientation//, console.log("Popping x,y,phi: ", state)  
  },  
    // pass plotting instructions to the turtle
    'F': () => {
      // create a line
      ctx.beginPath()
      // start it at x,y
      ctx.moveTo(x, y)
      //console.log(" x, y, phi:", x, y, orientation)
      // calculate the new coordinates 
      // line length depends on the number of iterations
      d = initLine/(tree.iterations + 1)
      // calculate 
      x += d * Math.cos(orientation)
      y += d * Math.sin(orientation)
      // draw a line to the new point 
      ctx.lineTo(x, y) 
      //console.log("New x, y", x, y)
      // plot the line with stroke()
      ctx.stroke()
      }
   }
});
tree.setAxiom('X');
tree.setProduction('X', 'F-[[X]+X]+F[+FX]-X');
tree.setProduction('F', 'FF');
tree.iterate(iterations);
tree.final();

</script>
</body>
</html>
